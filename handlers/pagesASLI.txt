package handlers

import (
	"html/template"
	"net/http"
)

func HomeHandler(w http.ResponseWriter, r *http.Request) {
	tmpl, err := template.ParseFiles("templates/home.html")
	if err != nil {
		http.Error(w, "Failed to load template", http.StatusInternalServerError)
		return
	}
	tmpl.Execute(w, nil)
}

func DashboardHandler(w http.ResponseWriter, r *http.Request) {
	tmpl, err := template.ParseFiles("templates/dashboard.html")
	if err != nil {
		http.Error(w, "Failed to load template", http.StatusInternalServerError)
		return
	}

	rows, err := db.Query("SELECT id, d, t, n, e, lt, ln, p, r FROM users LIMIT 5")
	if err != nil {
		http.Error(w, "Failed to fetch users data", http.StatusInternalServerError)
		return
	}
	defer rows.Close()

	var users []User
	for rows.Next() {
		var u User
		rows.Scan(&u.ID, &u.D, &u.T, &u.N, &u.E, &u.LT, &u.LN, &u.P, &u.R)
		users = append(users, u)
	}

	tmpl.Execute(w, users)
}

func LogDataHandler(w http.ResponseWriter, r *http.Request) {
	tmpl, err := template.ParseFiles("templates/logData.html")
	if err != nil {
		http.Error(w, "Failed to load template", http.StatusInternalServerError)
		return
	}

	rows, err := db.Query("SELECT id, d, t, n, k, l, i, f, a FROM logs")
	if err != nil {
		http.Error(w, "Failed to fetch users data", http.StatusInternalServerError)
		return
	}
	defer rows.Close()

	var logs []APILogData
	for rows.Next() {
		var u APILogData
		rows.Scan(&u.ID, &u.D, &u.T, &u.N, &u.K, &u.L, &u.I, &u.F, &u.A)
		logs = append(logs, u)
	}

	tmpl.Execute(w, logs)
}

func InformationHandler(w http.ResponseWriter, r *http.Request) {
	tmpl, err := template.ParseFiles("templates/informationLog.html")
	if err != nil {
		http.Error(w, "Failed to load template", http.StatusInternalServerError)
		return
	}

	rows, err := db.Query("SELECT id, d, t, n, e, lt, ln, p, r FROM users")
	if err != nil {
		http.Error(w, "Failed to fetch users data", http.StatusInternalServerError)
		return
	}
	defer rows.Close()

	var users []User
	for rows.Next() {
		var u User
		rows.Scan(&u.ID, &u.D, &u.T, &u.N, &u.E, &u.LT, &u.LN, &u.P, &u.R)
		users = append(users, u)
	}

	tmpl.Execute(w, users)
}

func UsersHandler(w http.ResponseWriter, r *http.Request) {
	tmpl, err := template.ParseFiles("templates/inputUsers.html")
	if err != nil {
		http.Error(w, "Failed to load template", http.StatusInternalServerError)
		return
	}
	tmpl.Execute(w, nil)
}

func InvoiceHandler(w http.ResponseWriter, r *http.Request) {
	tmpl, err := template.ParseFiles("templates/invoice.html")
	if err != nil {
		http.Error(w, "Failed to load template", http.StatusInternalServerError)
		return
	}
	tmpl.Execute(w, nil)
}
